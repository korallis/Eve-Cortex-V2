#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for code formatting and linting
npx lint-staged

# Check for security vulnerabilities
echo "ğŸ”’ Checking for security vulnerabilities..."
npm audit --audit-level=moderate
if [ $? -ne 0 ]; then
  echo "âŒ Security vulnerabilities found! Please fix before committing."
  exit 1
fi

# Check for deprecated dependencies
echo "ğŸ“¦ Checking for deprecated dependencies..."
npx better-npm-audit audit --level moderate
if [ $? -ne 0 ]; then
  echo "âŒ Deprecated dependencies found! Please update before committing."
  exit 1
fi

# Type check
echo "ğŸ” Running TypeScript check..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors found! Please fix before committing."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"